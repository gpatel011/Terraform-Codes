#Example
#Cretae S3 bucket
#Update Lock file in the Repo.and compare newly created and old lock file.

# Terraform Settings Block
terraform {
  # Terraform Version
  required_version = ">= 1.4.1"
  required_providers {
    # AWS Provider 
    aws = {
      source  = "hashicorp/aws"
      version = ">= 2.0.0"
    }
    # Random Provider
    random = {
      source  = "hashicorp/random"
      version = "3.0.0"
    }
  }
}

# Provider Block
provider "aws" {
  region = "us-east-1"
  profile = "default" # Defining it for default profile is Optional
}

# Resource Block: Create Random Pet Name 
# Here we are definig the format of the name of the bucket.After doing the "terraform plan" command it creates a bucket with any random name with the 
length 5 and there will be "-" seperator in between all the words.

resource "random_pet" "petname" {
  length    = 5
  separator = "-"
}

# Resource Block: Create AWS S3 Bucket
resource "aws_s3_bucket" "sample" {
  bucket = random_pet.petname.id
  acl    = "public-read"
  region = "us-east-1"  # Comment this if we are going to use AWS Provider v3.x version
}

/*
Output-
# Initialize Terraform
terraform init

ls -lrat

Here u will see 3 files created
.terraform
.terraform.lock.file
.terraform.lock.file-ORIGINAL

# Validate Terraform Configuration files
terraform validate

# Execute Terraform Plan
terraform plan

# Create Resources using Terraform Apply
terraform apply

Review .terraform.lock.hcl
Discuss about versions
Compare .terraform.lock.hcl-ORIGINAL & .terraform.lock.hcl
Backup .terraform.lock.hcl as .terraform.lock.hcl-FIRST-INIT
# Backup
cp .terraform.lock.hcl .terraform.lock.hcl-FIRST-INIT
Step-04: Upgrade the AWS provider version
For AWS Provider, with version constraint version = ">= 2.0.0", it is going to upgrade to latest 3.x.x version with command terraform init -upgrade
# Upgrade Provider Version
terraform init -upgrade
Review .terraform.lock.hcl
Discuss about AWS Versions
Compare .terraform.lock.hcl-FIRST-INIT & .terraform.lock.hcl
Step-05: Apply Terraform configuration with latest AWS Provider
Should fail due to S3 related latest changes came in AWS v3.x provider when compared to AWS v2.x provider
# Terraform Apply
terraform apply



